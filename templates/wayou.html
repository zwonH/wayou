<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link
      href="https://fonts.googleapis.com/css?family=Noto+Sans+KR:900&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="{{url_for('static', filename='style1.css')}}"
    />
    <!--Jquery-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <title>waYou</title>
  </head>

  <body>
    <h1 class="wayou">ì™€ìœ </h1>

    <div class="container">
      <div class="buttonShow" id="buttonShow_id" onclick="changeImage()">
        ğŸ•³
      </div>

      <div class="whiteBox">
        <div id="imgWrap_id"></div>
        <textarea
          class="dansang"
          id="dansang_id"
          placeholder="ê·¸ëŒ€ì˜ ì§§ì€ ë‹¨ìƒ..."
          maxlength="50"
          type="text"
          name="dansang"
        ></textarea>

        <div
          class="buttonSave"
          id="buttonSave_id"
          onclick="postComment()"
          onMouseOver="this.innerHTML='ğŸ“¸'"
          onMouseOut="this.innerHTML='ğŸ“·'"
        >
          ğŸ“·
        </div>
      </div>
    </div>
    <!--container class end-->

    <div class="textContainer" id="textContainer_id">
      <div class="spaceBox"><br /><br /><br /><br /><br /></div>
    </div>
    <!--textContainer class end-->
  </body>

  <script>
    let url = null;
    // ê¸°ë³¸ì„¸íŒ…
    $("#buttonSave_id").hide();
    // $("#img_id").hide();
    $("#dansang_id").hide();
    //* buttonHide()í•¨ìˆ˜ë§Œìœ¼ë¡œëŠ” reload ì‹œ, buttonì´ ìë™ìœ¼ë¡œ ë‹¤ì‹œ ë‚˜íƒ€ë‚˜ì„œ ìœ„ì˜ ì½”ë“œ ì¶”ê°€

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ ì‹¤í–‰ - comment getí•˜ëŠ” í•¨ìˆ˜ &
    window.onload = function() {
      getComment();
      getImgLink();
    };

    // ìŒ“ì¸ ì½”ë©˜íŠ¸ë“¤ ë¶ˆëŸ¬ì˜¤ê¸° (reloadì‹œ ìë™ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜)
    function getComment() {
      $.ajax({
        type: "GET",
        url: "/post",
        data: {},
        success: function(response) {
          let textBoxes = response["comments"];
          for (let i = textBoxes.length - 1; i > -1; i--) {
            let comment = textBoxes[i]["comment"];
            makeTextBox(comment);
          }
        }
      });
    }

    // í˜ì´ì§€ ë¡œë“œë˜ë©´ ìë™ìœ¼ë¡œ í¬ë¡¤ë§ì„ ì‹œì‘í•´ì„œ ì´ë¯¸ì§€ ë§í¬ë¥¼ ë°›ì•„ë†“ëŠ”ë‹¤
    function getImgLink() {
      $.ajax({
        type: "GET",
        url: "/img",
        data: [],
        success: function(imgSrc) {
          url = imgSrc;
          console.log(url);
        }
      });
    }

    // div ì¶”ê°€ ë²„ì „
    function changeImage() {
      if ($("#img_id").css("display") == "block") {
        $("#buttonShow_id").text("?");
      } else {
        console.log(url);
        if (url == null) {
          alert("ì¢€ ë” ê¸°ë‹¤ë¦¬ì‹œì˜¤ ğŸ˜");
        } else {
          let imgBox =
            '<div class="img" id="img_id"\
            style="background-image: url(' +
            url +
            ')">\
        </div>';
          $("#imgWrap_id").append(imgBox);
          $("#dansang_id").show();
          $("#img_id").show();
        }
      }
    }

    // textareaì— ê¸€ì ì…ë ¥ ì‹œì‘ ì‹œ ìë™ìœ¼ë¡œ ë²„íŠ¼ì´ ë‚˜íƒ€ë‚¨
    //* ì•„ë˜ ì½”ë“œ ì •ìƒì ìœ¼ë¡œ ì‘ë™!!!
    $(document).keyup(".code_textarea", function() {
      let content = $.trim($("#dansang_id").val());
      if (content.length === 0) {
        $("#buttonSave_id").hide();
      } else {
        $("#buttonSave_id").show();
      }
    });

    // comment postí•˜ê¸°
    function postComment() {
      let comment = $("#dansang_id").val();

      $.ajax({
        type: "POST",
        url: "/post",
        data: {
          comment_give: comment
        },
        success: function(response) {
          if (response["result"] == "success") {
            alert("ì°°ì¹µ");
            window.location.reload();
          } else {
            alert("ì™œì§€... ì €ì¥ ì˜¤ë¥˜...");
          }
        },
        error: function(errorAlert) {
          alert("ì™œì§€... ì €ì¥ ì˜¤ë¥˜...");
        }
      });
    }

    // ìš°ì¸¡ì— commentë“¤ ìŒ“ì´ê²Œë”
    function makeTextBox(comment) {
      let oneTextBox =
        '<div class="textBox">\
             ' + comment + " </div>";
      $("#textContainer_id").append(oneTextBox);
    }
  </script>
</html>
